<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iran Risk Ã— ABS/SM ì›ê°€ ëŒ€ì‘ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    /* â”€â”€ ê¸°ë³¸ ë ˆì´ì•„ì›ƒ */
    body {
      font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
      min-height: 100vh;
    }

    /* â”€â”€ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes pulse-red {
      0%, 100% { opacity: 1; }
      50%       { opacity: 0.4; }
    }
    @keyframes blink {
      0%, 100% { border-color: #ef4444; }
      50%       { border-color: #7f1d1d; }
    }
    .alert-blink {
      animation: pulse-red 1.4s ease-in-out infinite;
    }
    .alert-border {
      animation: blink 1.4s ease-in-out infinite;
    }

    /* â”€â”€ WTI ëŒ€í˜• ë””ìŠ¤í”Œë ˆì´ */
    #wti-price {
      font-size: 3.5rem;
      font-weight: 900;
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.03em;
      transition: color 0.4s;
    }

    /* â”€â”€ ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
    input[type=range] {
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: #334155;
      outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #f59e0b;
      cursor: pointer;
      box-shadow: 0 0 6px #f59e0b88;
    }

    /* â”€â”€ ì¹´ë“œ */
    .metric-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 1rem;
      padding: 1.25rem 1.5rem;
      transition: border-color 0.3s;
    }
    .metric-card:hover {
      border-color: rgba(255,255,255,0.2);
    }

    /* â”€â”€ ì‹œë‚˜ë¦¬ì˜¤ í–‰ */
    .scenario-row {
      background: rgba(255,255,255,0.03);
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      border-left: 4px solid transparent;
      transition: background 0.2s;
    }
    .scenario-row:hover {
      background: rgba(255,255,255,0.07);
    }

    /* â”€â”€ ìƒíƒœ ë±ƒì§€ */
    .badge-ok      { background:#065f46; color:#6ee7b7; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }
    .badge-warn    { background:#78350f; color:#fcd34d; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }
    .badge-danger  { background:#7f1d1d; color:#fca5a5; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }

    /* â”€â”€ í† ìŠ¤íŠ¸ ì•Œë¦¼ */
    #toast {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 9999;
      display: none;
      background: #7f1d1d;
      border: 1px solid #ef4444;
      border-radius: 0.75rem;
      padding: 1rem 1.5rem;
      max-width: 320px;
      box-shadow: 0 0 30px #ef444455;
    }
  </style>
</head>
<body class="p-4 md:p-8">

  <!-- â”€â”€ í† ìŠ¤íŠ¸ ê²½ë³´ -->
  <div id="toast">
    <div class="text-red-400 font-black text-sm mb-1">âš  ABS ë§ˆì§„ ê²½ë³´</div>
    <div id="toast-msg" class="text-white text-sm"></div>
    <button onclick="document.getElementById('toast').style.display='none'"
            class="mt-2 text-xs text-red-300 underline">ë‹«ê¸°</button>
  </div>

  <div class="max-w-7xl mx-auto space-y-6">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- í—¤ë” -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="bg-gradient-to-r from-red-950 to-slate-900 p-6 rounded-2xl border border-red-800/40 shadow-2xl">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-black text-yellow-400 tracking-tight">
            ğŸ”´ IRAN CONFLICT Â· ABS/SM COST DASHBOARD
          </h1>
          <p class="text-slate-400 text-sm mt-1">
            LAM Advanced Procurement  |  WTI CL=F ì‹¤ì‹œê°„ ë°˜ì˜  |  ì—‘ì…€ ìµœì‹  ì•µì»¤: <span class="text-yellow-400">2026-01-16</span>
          </p>
        </div>
        <div class="text-right">
          <div id="update-time" class="text-slate-500 text-xs">ì—…ë°ì´íŠ¸ ì¤‘...</div>
          <div id="wti-source" class="text-slate-600 text-xs mt-0.5"></div>
        </div>
      </div>

      <!-- WTI ë©”ì¸ ë””ìŠ¤í”Œë ˆì´ -->
      <div class="mt-5 flex flex-wrap items-end gap-6">
        <div>
          <div class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-1">WTI Crude Oil (CL=F)</div>
          <div id="wti-price" class="text-yellow-400">$--.-</div>
        </div>
        <div class="flex gap-4 pb-2">
          <div>
            <div class="text-xs text-slate-500">ì‹¤ì¸¡ ABS Gap</div>
            <div id="actual-gap" class="text-2xl font-black text-emerald-400">$---</div>
          </div>
          <div>
            <div class="text-xs text-slate-500">ì‹¤ì¸¡ SM Margin</div>
            <div id="actual-sm-margin" class="text-2xl font-black text-red-400">$---</div>
          </div>
        </div>
        <!-- ê²½ë³´ ë ˆë²¨ ë±ƒì§€ -->
        <div id="alert-badge" class="pb-2">
          <span class="badge-warn">ë°ì´í„° ë¡œë”© ì¤‘</span>
        </div>
      </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ì‹¤ì‹œê°„ ê³„ì‚° ì¹´ë“œ (CSV ê¸°ë°˜) -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section>
      <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-3">ğŸ“¡ ì‹¤ì‹œê°„ ì‚°ì¶œê°’ (GitHub Actions ìë™ê°±ì‹ )</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">

        <div class="metric-card">
          <div class="text-xs text-slate-500 mb-1">WTI</div>
          <div id="c-wti" class="text-xl font-black text-yellow-400">--</div>
          <div class="text-xs text-slate-600 mt-1">$/bbl</div>
        </div>

        <div class="metric-card">
          <div class="text-xs text-slate-500 mb-1">Benzene (ì˜ˆì¸¡)</div>
          <div id="c-bz" class="text-xl font-black text-purple-400">--</div>
          <div class="text-xs text-slate-600 mt-1">$/mt</div>
        </div>

        <div class="metric-card">
          <div class="text-xs text-slate-500 mb-1">Ethylene (ì˜ˆì¸¡)</div>
          <div id="c-et" class="text-xl font-black text-green-400">--</div>
          <div class="text-xs text-slate-600 mt-1">$/mt</div>
        </div>

        <div class="metric-card">
          <div class="text-xs text-slate-500 mb-1">SM Market (ì˜ˆì¸¡)</div>
          <div id="c-sm-mkt" class="text-xl font-black text-blue-400">--</div>
          <div class="text-xs text-slate-600 mt-1">$/mt FOB Korea</div>
        </div>

        <div class="metric-card">
          <div class="text-xs text-slate-500 mb-1">SM Margin</div>
          <div id="c-sm-margin" class="text-xl font-black">--</div>
          <div class="text-xs text-slate-600 mt-1">ì‹œì¥ê°€ - ì›ê°€</div>
        </div>

        <div class="metric-card col-span-2 md:col-span-1">
          <div class="text-xs text-slate-500 mb-1">ABS Gap (ì˜ˆì¸¡)</div>
          <div id="c-abs-gap" class="text-xl font-black text-emerald-400">--</div>
          <div class="text-xs text-slate-600 mt-1">ì‹œì¥ê°€ - ì›ê°€</div>
        </div>

      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ì‹¤ì¸¡ ì•µì»¤ ì¹´ë“œ (ì—‘ì…€ ìµœì‹ ) -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section>
      <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-3">
        ğŸ“‹ ì‹¤ì¸¡ ì•µì»¤ (ì—‘ì…€ Weekly_ì›ë£Œê°€_ë™í–¥ Â· 2026-01-16 ìµœì‹ )
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">

        <div class="metric-card border-l-4 border-yellow-500">
          <div class="text-xs text-slate-500 mb-1">BZ FOB Korea</div>
          <div class="text-xl font-black text-yellow-300">$705</div>
          <div class="text-xs text-slate-600 mt-1">â†‘ from $655</div>
        </div>

        <div class="metric-card border-l-4 border-green-600">
          <div class="text-xs text-slate-500 mb-1">ET CFR Taiwan</div>
          <div class="text-xl font-black text-green-300">$710</div>
          <div class="text-xs text-slate-600 mt-1">â†“ from $745</div>
        </div>

        <div class="metric-card border-l-4 border-blue-600">
          <div class="text-xs text-slate-500 mb-1">SM FOB Korea</div>
          <div class="text-xl font-black text-blue-300">$913</div>
          <div class="text-xs text-slate-600 mt-1">â†‘ from $795</div>
        </div>

        <div class="metric-card border-l-4 border-red-700">
          <div class="text-xs text-slate-500 mb-1">SM Cost</div>
          <div class="text-xl font-black text-red-300">$938</div>
          <div class="text-xs text-slate-600 mt-1 text-red-500 font-bold">âš  ì—­ë§ˆì§„ -$25</div>
        </div>

        <div class="metric-card border-l-4 border-orange-600">
          <div class="text-xs text-slate-500 mb-1">ABS CFR China</div>
          <div class="text-xl font-black text-orange-300">$1,190</div>
          <div class="text-xs text-slate-600 mt-1">â†‘ from $1,170</div>
        </div>

        <div class="metric-card border-l-4 border-red-600">
          <div class="text-xs text-slate-500 mb-1">ABS Cost</div>
          <div class="text-xl font-black text-red-300">$996</div>
          <div class="text-xs text-slate-600 mt-1">â†‘ ê¸‰ë“± ì¶”ì„¸</div>
        </div>

        <div class="metric-card border-l-4 border-emerald-600" id="abs-gap-card">
          <div class="text-xs text-slate-500 mb-1">ABS Gap</div>
          <div class="text-xl font-black text-emerald-300">$194</div>
          <div class="text-xs text-yellow-500 mt-1 font-bold">â†“ ê²½ë³´ ì„ë°• $150</div>
        </div>

      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- WTI ì‹œë‚˜ë¦¬ì˜¤ ìŠ¬ë¼ì´ë” (ì¦‰ì„ ê³„ì‚°) -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="bg-slate-800/60 border border-slate-700 rounded-2xl p-6">
      <h2 class="text-yellow-400 font-black text-sm tracking-widest uppercase mb-4">
        ğŸ› ì´ë€ ì‚¬íƒœ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´í„° (ì¦‰ì„ ê³„ì‚°)
      </h2>

      <div class="grid md:grid-cols-2 gap-6">

        <!-- ìŠ¬ë¼ì´ë” ì»¨íŠ¸ë¡¤ -->
        <div class="space-y-5">
          <!-- WTI ìŠ¬ë¼ì´ë” -->
          <div>
            <div class="flex justify-between text-sm mb-2">
              <span class="text-slate-400 font-semibold">WTI ìœ ê°€</span>
              <span class="text-yellow-400 font-black text-lg" id="slider-wti-val">$67.00 /bbl</span>
            </div>
            <input type="range" id="slider-wti" min="50" max="120" step="0.5" value="67"
                   class="w-full" oninput="onSliderChange()">
            <div class="flex justify-between text-xs text-slate-600 mt-1">
              <span>$50 (í˜„ì¬ ì €ì )</span><span>$85 (í˜¸ë¥´ë¬´ì¦ˆ ìœ„ê¸°)</span><span>$120 (ë´‰ì‡„)</span>
            </div>
          </div>

          <!-- ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ ìŠ¬ë¼ì´ë” -->
          <div>
            <div class="flex justify-between text-sm mb-2">
              <span class="text-slate-400 font-semibold">ì´ë€ ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„</span>
              <span class="text-orange-400 font-black text-lg" id="slider-risk-val">+$0 /t</span>
            </div>
            <input type="range" id="slider-risk" min="0" max="300" step="10" value="0"
                   class="w-full" oninput="onSliderChange()">
            <div class="flex justify-between text-xs text-slate-600 mt-1">
              <span>$0 (í‰ì‹œ)</span><span>$150 (ë¯¸ì‚¬ì¼ íƒ€ê²©)</span><span>$300 (í˜¸ë¥´ë¬´ì¦ˆ ë´‰ì‡„)</span>
            </div>
          </div>

          <!-- í”„ë¦¬ì…‹ ë²„íŠ¼ -->
          <div>
            <div class="text-xs text-slate-500 mb-2 font-semibold uppercase tracking-wider">ë¹ ë¥¸ ì‹œë‚˜ë¦¬ì˜¤</div>
            <div class="flex flex-wrap gap-2">
              <button onclick="setScenario(59.44,0)"    class="preset-btn bg-emerald-900 hover:bg-emerald-800 text-emerald-200 text-xs font-bold px-3 py-1.5 rounded-lg border border-emerald-700 transition">Base $59</button>
              <button onclick="setScenario(70,50)"      class="preset-btn bg-amber-900 hover:bg-amber-800 text-amber-200 text-xs font-bold px-3 py-1.5 rounded-lg border border-amber-700 transition">Mild $70</button>
              <button onclick="setScenario(80,100)"     class="preset-btn bg-orange-900 hover:bg-orange-800 text-orange-200 text-xs font-bold px-3 py-1.5 rounded-lg border border-orange-700 transition">Moderate $80</button>
              <button onclick="setScenario(90,150)"     class="preset-btn bg-red-900 hover:bg-red-800 text-red-200 text-xs font-bold px-3 py-1.5 rounded-lg border border-red-700 transition">Severe $90</button>
              <button onclick="setScenario(100,200)"    class="preset-btn bg-red-950 hover:bg-red-900 text-red-300 text-xs font-bold px-3 py-1.5 rounded-lg border border-red-800 transition alert-border">Crisis $100</button>
            </div>
          </div>
        </div>

        <!-- ì¦‰ì„ ê³„ì‚° ê²°ê³¼ -->
        <div class="bg-slate-900 rounded-xl p-5 border border-slate-700">
          <div class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-4">ì¦‰ì„ ê³„ì‚° ê²°ê³¼</div>

          <div class="space-y-3">
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">Benzene (ì˜ˆì¸¡)</span>
              <span id="sim-bz" class="text-purple-400 font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">Ethylene (ì˜ˆì¸¡)</span>
              <span id="sim-et" class="text-green-400 font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">SM Market (ì˜ˆì¸¡)</span>
              <span id="sim-sm-mkt" class="text-blue-400 font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">SM Margin</span>
              <span id="sim-sm-margin" class="font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">ABS Market (ë¦¬ìŠ¤í¬ í¬í•¨)</span>
              <span id="sim-abs-mkt" class="text-orange-400 font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center border-b border-slate-700 pb-2">
              <span class="text-slate-400 text-sm">ABS Cost (ì˜ˆì¸¡)</span>
              <span id="sim-abs-cost" class="text-red-400 font-black text-lg">$---</span>
            </div>
            <div class="flex justify-between items-center pt-1">
              <span class="text-white font-black text-sm">ABS GAP (ë§ˆì§„)</span>
              <span id="sim-abs-gap" class="font-black text-2xl">$---</span>
            </div>
          </div>

          <!-- êµ¬ë§¤ ì „ëµ ì¸ì‚¬ì´íŠ¸ -->
          <div id="strategy-box" class="mt-4 p-3 rounded-lg bg-slate-800 border border-slate-600 text-xs leading-relaxed">
            ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì‘í•˜ì—¬ êµ¬ë§¤ ì „ëµ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
          </div>
        </div>
      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ì´ë€ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½ í…Œì´ë¸” -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="bg-slate-800/40 border border-slate-700 rounded-2xl p-5">
      <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-4">ğŸ“Š 5ë‹¨ê³„ ì´ë€ ë¦¬ìŠ¤í¬ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½</h2>

      <div class="space-y-2" id="scenario-table">
        <!-- JavaScriptë¡œ ë Œë”ë§ -->
      </div>

      <div class="mt-3 text-xs text-slate-600">
        * ABS Market = WTI íšŒê·€ + ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ ì ìš© / ABS Cost = ì•µì»¤($995.8) + WTI ë¯¼ê°ë„ $8.5/bbl ì ìš©
      </div>
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- ì‹œê°í™” ë¦¬í¬íŠ¸ (PNG) -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="bg-white/[0.03] border border-white/10 rounded-2xl p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-slate-300 font-black text-sm uppercase tracking-widest border-l-4 border-red-600 pl-3">
          ğŸ“ˆ VISUALIZED REPORT (ìë™ ê°±ì‹ )
        </h2>
        <button onclick="refreshReport()"
                class="text-xs text-slate-400 border border-slate-700 rounded-lg px-3 py-1.5 hover:bg-slate-700 transition">
          ğŸ”„ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>
      <img id="report-img"
           src="risk_simulation_report.png"
           class="w-full h-auto rounded-xl border border-slate-700"
           onerror="this.style.opacity='0.3'; this.alt='ì°¨íŠ¸ ë¡œë”© ì‹¤íŒ¨ - GitHub Actions ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤'">
    </section>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Calculation Logic ì„¤ëª… -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <section class="bg-slate-800/30 border border-slate-700 rounded-2xl p-5">
      <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-3">âš™ Calculation Logic</h2>
      <div class="grid md:grid-cols-2 gap-4 text-xs text-slate-400 leading-loose">
        <div>
          <div class="text-slate-300 font-bold mb-1">ì›ë£Œê°€ ì˜ˆì¸¡ (WTI íšŒê·€)</div>
          <div>â€¢ BZ = WTI Ã— 10.23 + 96.42</div>
          <div>â€¢ ET = WTI Ã— 5.55 + 456.21</div>
          <div>â€¢ SM Market = WTI Ã— 19.86 - 450.23</div>
          <div>â€¢ ABS Market = WTI Ã— 7.58 + 825.47 + Risk</div>
        </div>
        <div>
          <div class="text-slate-300 font-bold mb-1">ì›ê°€ ê³„ì‚°</div>
          <div>â€¢ SM Cost = BZ Ã— 0.78 + ET Ã— 0.28 + $45</div>
          <div>â€¢ ABS Cost = Anchor $995.8 + (WTI - $59.44) Ã— 8.5</div>
          <div>â€¢ ì•µì»¤: ì—‘ì…€ 2026-01-16 ì‹¤ì¸¡ì¹˜ ê¸°ë°˜</div>
          <div>â€¢ ê²½ë³´ ì„ê³„: ABS Gap &lt; $150/t</div>
        </div>
      </div>
    </section>

    <!-- í‘¸í„° -->
    <footer class="text-center text-slate-700 text-xs pb-4">
      LAM Advanced Procurement Team 1  |  Source: Yahoo Finance CL=F + Weekly ì›ë£Œê°€ë™í–¥  |  Auto-refresh every 30s
    </footer>

  </div><!-- /max-w-7xl -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- JavaScript -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
  // â”€â”€ íšŒê·€ ìƒìˆ˜ (simulation.pyì™€ ì™„ì „ ë™ì¼í•˜ê²Œ ë§ì¶¤)
  const REG = {
    BZ:  { m:  9.65, b:  104.40 },
    ET:  { m: -5.41, b: 1010.93 },   // ê³µê¸‰ê³¼ì‰â†’ì—­ìƒê´€, ì‹¤ì¸¡ íšŒê·€
    SM:  { m: 20.07, b:  -341.73 },
    ABS: { m:  7.58, b:   825.47 },
  };
  const ANCHOR_WTI  = 59.44;   // ì—‘ì…€ ìµœì‹  WTI
  const ANCHOR_COST = 995.80;  // ì—‘ì…€ ìµœì‹  ABS Cost

  // â”€â”€ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
  const SCENARIOS = [
    { label:'Base',     wti: 59.44, risk:   0, color:'#10b981', textColor:'emerald' },
    { label:'Mild',     wti: 70.00, risk:  50, color:'#f59e0b', textColor:'amber'   },
    { label:'Moderate', wti: 80.00, risk: 100, color:'#f97316', textColor:'orange'  },
    { label:'Severe',   wti: 90.00, risk: 150, color:'#ef4444', textColor:'red'     },
    { label:'Crisis',   wti:100.00, risk: 200, color:'#b91c1c', textColor:'red'     },
  ];

  // â”€â”€ ì›ê°€ ê³„ì‚° í•¨ìˆ˜
  function calcCosts(wti, risk = 0) {
    const bz       = wti * REG.BZ.m  + REG.BZ.b;
    const et       = wti * REG.ET.m  + REG.ET.b;
    const smMkt    = wti * REG.SM.m  + REG.SM.b;
    const smCost   = bz * 0.78 + et * 0.28 + 45;
    const smMargin = smMkt - smCost;
    const absMkt   = wti * REG.ABS.m + REG.ABS.b + risk;
    const absCost  = ANCHOR_COST + (wti - ANCHOR_WTI) * 8.5;
    const absGap   = absMkt - absCost;
    return { wti, bz, et, smMkt, smCost, smMargin, absMkt, absCost, absGap, risk };
  }

  // â”€â”€ ìˆ«ì í¬ë§·
  function fmt(v, sign=false) {
    if (v === null || v === undefined || isNaN(v)) return '--';
    const s = sign && v >= 0 ? '+' : '';
    return s + '$' + Math.round(v).toLocaleString();
  }

  // â”€â”€ ê²½ë³´ ë±ƒì§€ í…ìŠ¤íŠ¸
  function getAlertBadge(absGap, smMargin) {
    if (absGap < 0 || smMargin < -100) {
      return `<span class="badge-danger alert-blink">ğŸ”´ CRITICAL - ì¦‰ê° ëŒ€ì‘</span>`;
    } else if (absGap < 150) {
      return `<span class="badge-warn">ğŸŸ¡ WARNING - ABS Gap ${Math.round(absGap)}/t</span>`;
    }
    return `<span class="badge-ok">ğŸŸ¢ NORMAL</span>`;
  }

  // â”€â”€ êµ¬ë§¤ ì „ëµ ì¸ì‚¬ì´íŠ¸
  function getStrategy(r) {
    if (r.absGap < 0) {
      return `<span class="text-red-400 font-bold">ğŸ”´ ì—­ë§ˆì§„ ì „í™˜ â€” ì¦‰ì‹œ í˜‘ìƒ ê°€ê²© ì¬ì¡°ì • ìš”ì²­. êµ¬ë§¤ ê³„ì•½ ì—°ì¥ ê¸ˆì§€. ëŒ€ì²´ ê³µê¸‰ì‚¬ ê¸´ê¸‰ ë°œêµ´ í•„ìš”.</span>`;
    } else if (r.absGap < 100) {
      return `<span class="text-orange-400 font-bold">ğŸŸ  GAP ìœ„í—˜ â€” êµ¬ë§¤ ë‹¨ê°€ ì¸í•˜ or íŒë§¤ê°€ ì¸ìƒ ìš”ì²­. ì¬ê³  ì¶•ì†Œ ì „ëµ ê²€í† .</span>`;
    } else if (r.absGap < 200) {
      return `<span class="text-yellow-400">ğŸŸ¡ GAP ì¶•ì†Œ ì¶”ì„¸ â€” ì ì • ì¬ê³  ìœ ì§€. WTI ì¶”ê°€ ìƒìŠ¹ ì‹œ í—¤ì§• ê²€í† . ê³µê¸‰ì‚¬ ê³„ì•½ ë‹¨ê¸°í™”.</span>`;
    } else if (r.smMargin < 0) {
      return `<span class="text-blue-400">ğŸ”µ SM ì—­ë§ˆì§„ â€” SM ë©”ì´ì»¤ ê°ì‚° ê°€ëŠ¥ì„± â†’ ìˆ˜ê¸‰ íƒ€ì´íŠ¸ â†’ ABS ì›ê°€ ì¶”ê°€ ìƒìŠ¹ ì˜ˆìƒ. ì„ ì œ ì¬ê³  í™•ë³´ ê²€í† .</span>`;
    }
    return `<span class="text-emerald-400">ğŸŸ¢ ì •ìƒ ë²”ìœ„ â€” í˜„í–‰ êµ¬ë§¤ ì „ëµ ìœ ì§€. ìœ ê°€ WTI $80 ëŒíŒŒ ì‹œ ì¦‰ì‹œ ì¬í‰ê°€ ê¶Œì¥.</span>`;
  }

  // â”€â”€ ì‹œë‚˜ë¦¬ì˜¤ í…Œì´ë¸” ë Œë”ë§
  function renderScenarioTable() {
    const el = document.getElementById('scenario-table');
    el.innerHTML = SCENARIOS.map(s => {
      const r = calcCosts(s.wti, s.risk);
      const gapColor = r.absGap < 0 ? '#ef4444' : r.absGap < 150 ? '#f59e0b' : '#10b981';
      const smColor  = r.smMargin < 0 ? '#ef4444' : '#10b981';
      const borderStyle = `border-left-color: ${s.color}`;
      return `
        <div class="scenario-row" style="${borderStyle}">
          <div class="flex flex-wrap items-center gap-3 text-sm">
            <span class="font-black w-20" style="color:${s.color}">${s.label}</span>
            <span class="text-slate-400 w-16">WTI <b class="text-white">$${s.wti.toFixed(0)}</b></span>
            <span class="text-slate-400 w-20">Risk <b class="text-orange-400">+$${s.risk}</b></span>
            <span class="text-slate-400 w-32">ABS Mkt <b class="text-blue-300">${fmt(r.absMkt)}</b></span>
            <span class="text-slate-400 w-32">ABS Cost <b class="text-red-300">${fmt(r.absCost)}</b></span>
            <span class="w-32">
              ABS Gap <b style="color:${gapColor}" class="font-black">${fmt(r.absGap, true)}</b>
            </span>
            <span class="w-32">
              SM Margin <b style="color:${smColor}">${fmt(r.smMargin, true)}</b>
            </span>
          </div>
        </div>`;
    }).join('');
  }

  // â”€â”€ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
  function onSliderChange() {
    const wti  = parseFloat(document.getElementById('slider-wti').value);
    const risk = parseFloat(document.getElementById('slider-risk').value);
    document.getElementById('slider-wti-val').textContent  = `$${wti.toFixed(2)} /bbl`;
    document.getElementById('slider-risk-val').textContent = `+$${risk.toFixed(0)} /t`;

    const r = calcCosts(wti, risk);
    document.getElementById('sim-bz').textContent       = fmt(r.bz);
    document.getElementById('sim-et').textContent       = fmt(r.et);
    document.getElementById('sim-sm-mkt').textContent   = fmt(r.smMkt);

    const smMarginEl = document.getElementById('sim-sm-margin');
    smMarginEl.textContent = fmt(r.smMargin, true);
    smMarginEl.className   = 'font-black text-lg ' + (r.smMargin < 0 ? 'text-red-400' : 'text-emerald-400');

    document.getElementById('sim-abs-mkt').textContent  = fmt(r.absMkt);
    document.getElementById('sim-abs-cost').textContent = fmt(r.absCost);

    const gapEl = document.getElementById('sim-abs-gap');
    gapEl.textContent = fmt(r.absGap, true);
    gapEl.className   = 'font-black text-2xl ' + (r.absGap < 0 ? 'text-red-500 alert-blink' : r.absGap < 150 ? 'text-yellow-400' : 'text-emerald-400');

    document.getElementById('strategy-box').innerHTML = getStrategy(r);
  }

  // â”€â”€ í”„ë¦¬ì…‹ ì‹œë‚˜ë¦¬ì˜¤ ì ìš©
  function setScenario(wti, risk) {
    document.getElementById('slider-wti').value  = wti;
    document.getElementById('slider-risk').value = risk;
    onSliderChange();
  }

  // â”€â”€ CSV ë¡œë“œ ë° í—¤ë” ì¹´ë“œ ì—…ë°ì´íŠ¸
  function loadCSV() {
    // GitHub Pages í™˜ê²½ì—ì„œ CORS ë¬¸ì œ ì—†ì´ ë™ì‘
    // PapaParse download:true ì‚¬ìš© + ìºì‹œ ë°©ì§€ íŒŒë¼ë¯¸í„°
    const url = 'simulation_result.csv?t=' + Date.now();
    Papa.parse(url, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(result) {
        if (!result.data || result.data.length === 0) {
          console.warn('CSV ë°ì´í„° ì—†ìŒ - GitHub Actions ì‹¤í–‰ ëŒ€ê¸° ì¤‘');
          return;
        }
        const d = result.data[0];

        // WTI í—¤ë”
        const wti = parseFloat(d.WTI);
        document.getElementById('wti-price').textContent = `$${wti.toFixed(2)}`;
        document.getElementById('c-wti').textContent     = `$${wti.toFixed(2)}`;
        document.getElementById('c-bz').textContent      = fmt(parseFloat(d.BZ));
        document.getElementById('c-et').textContent      = fmt(parseFloat(d.ET));
        document.getElementById('c-sm-mkt').textContent  = fmt(parseFloat(d.SM_Market));

        const smMargin = parseFloat(d.SM_Margin);
        const smEl = document.getElementById('c-sm-margin');
        smEl.textContent = fmt(smMargin, true);
        smEl.className   = 'text-xl font-black ' + (smMargin < 0 ? 'text-red-400' : 'text-emerald-400');

        const absGap = parseFloat(d.ABS_Gap);
        const gapEl  = document.getElementById('c-abs-gap');
        gapEl.textContent = fmt(absGap, true);
        gapEl.className   = 'text-xl font-black ' + (absGap < 0 ? 'text-red-500 alert-blink' : absGap < 150 ? 'text-yellow-400' : 'text-emerald-400');

        // í—¤ë” ì‹¤ì¸¡ í‘œì‹œ
        document.getElementById('actual-gap').textContent      = fmt(parseFloat(d.Actual_ABS_Gap || d.ABS_Gap), true);
        document.getElementById('actual-sm-margin').textContent = fmt(parseFloat(d.Actual_SM_Margin || d.SM_Margin), true);

        // ê²½ë³´ ë±ƒì§€
        document.getElementById('alert-badge').innerHTML = getAlertBadge(absGap, smMargin);

        // ì—…ë°ì´íŠ¸ ì‹œê°„
        document.getElementById('update-time').textContent  = 'ê°±ì‹ : ' + (d.UpdateTime || 'ì•Œ ìˆ˜ ì—†ìŒ');
        document.getElementById('wti-source').textContent   = d.WTI_Source || '';

        // ìŠ¬ë¼ì´ë” WTI ì´ˆê¸°ê°’ = CSV WTIë¡œ ë™ê¸°í™”
        if (!isNaN(wti)) {
          document.getElementById('slider-wti').value = wti.toFixed(2);
          document.getElementById('slider-wti-val').textContent = `$${wti.toFixed(2)} /bbl`;
          onSliderChange();
        }

        // í† ìŠ¤íŠ¸ ê²½ë³´
        if (absGap < 150) {
          document.getElementById('toast-msg').textContent =
            `ABS Gap $${Math.round(absGap)}/t â€” ëª©í‘œ($150) ${Math.round(150 - absGap)} ë¶€ì¡±. ì¦‰ì‹œ ê²€í†  í•„ìš”.`;
          document.getElementById('toast').style.display = 'block';
        }
      },
      error: function(err) {
        console.warn('CSV ë¡œë“œ ì‹¤íŒ¨:', err);
        document.getElementById('update-time').textContent = 'CSV ë¡œë“œ ì‹¤íŒ¨ - GitHub Actions ì‹¤í–‰ ëŒ€ê¸°';
      }
    });
  }

  // â”€â”€ ì°¨íŠ¸ ì´ë¯¸ì§€ ìƒˆë¡œê³ ì¹¨
  function refreshReport() {
    document.getElementById('report-img').src = 'risk_simulation_report.png?t=' + Date.now();
  }

  // â”€â”€ ì´ˆê¸°í™”
  renderScenarioTable();
  onSliderChange();  // ìŠ¬ë¼ì´ë” ì´ˆê¸°ê°’ ê³„ì‚°
  loadCSV();

  // 30ì´ˆë§ˆë‹¤ CSV ìë™ ê°±ì‹ 
  setInterval(loadCSV, 30000);
  // 5ë¶„ë§ˆë‹¤ ì°¨íŠ¸ ì´ë¯¸ì§€ ê°±ì‹ 
  setInterval(refreshReport, 300000);
  </script>

</body>
</html>
