<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>석유화학 리스크 관리 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* 폰트 및 커스텀 스타일 정의 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .risk-high { color: #ef4444; border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <header class="mb-8 flex justify-between items-end border-b pb-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Middle East Conflict Risk Analyzer</h1>
                <p class="text-slate-500 mt-2">석유화학(ABS) 원가 및 물류 리스크 시뮬레이션 결과</p>
            </div>
            <div class="text-right">
                <span class="text-sm text-slate-400">마지막 업데이트: </span>
                <span id="update-time" class="text-sm font-semibold text-slate-600">-</span>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-sm font-semibold text-slate-500 mb-2">예상 유가 (WTI)</h3>
                <p id="oil-price" class="text-3xl font-bold text-blue-600">Loading...</p>
                <p class="text-xs text-slate-400 mt-2">※ 시나리오 기반 예측치</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h3 class="text-sm font-semibold text-slate-500 mb-2">예상 ABS Landed Cost</h3>
                <p id="abs-cost" class="text-3xl font-bold text-red-600">Loading...</p>
                <p class="text-xs text-slate-400 mt-2">※ 물류 프리미엄 포함</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-red-100 risk-high">
                <h3 class="text-sm font-semibold text-red-600 mb-2">Strategic Action</h3>
                <p class="text-lg font-bold text-slate-800">안전 재고 2개월치 선확보 권고</p>
                <p class="text-xs text-slate-400 mt-2">※ 호르무즈 해협 리스크 반영</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4">Cost Projection Chart</h3>
                <img id="risk-chart" src="risk_simulation_report.png" alt="Risk Simulation Chart" class="w-full h-auto rounded-lg">
                <p class="text-xs text-center text-slate-400 mt-4">Graph generated by Python Simulator</p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 overflow-x-auto">
                <h3 class="font-bold text-slate-700 mb-4">Simulation Detail (CSV)</h3>
                <table class="w-full text-sm text-left">
                    <thead class="bg-slate-50 text-slate-600">
                        <tr>
                            <th class="p-2">항목</th>
                            <th class="p-2">예측값 (USD)</th>
                        </tr>
                    </thead>
                    <tbody id="csv-table-body" class="text-slate-700">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // CSV 파일을 읽어와 대시보드에 업데이트하는 함수
        function updateDashboard() {
            Papa.parse("simulation_result.csv", {
                download: true,
                header: true,
                complete: function(results) {
                    const data = results.data[0]; // 최신 예측 데이터 가져오기
                    if (data) {
                        // 주요 지표 업데이트
                        document.getElementById('oil-price').innerText = `$${parseFloat(data.Pred_WTI).toFixed(2)}`;
                        document.getElementById('abs-cost').innerText = `$${parseFloat(data.Landed_Cost).toFixed(2)}`;
                        document.getElementById('update-time').innerText = data.Date;

                        // 테이블 데이터 동적 생성
                        const tableBody = document.getElementById('csv-table-body');
                        tableBody.innerHTML = `
                            <tr class="border-b">
                                <td class="p-2 font-semibold">시나리오 레벨</td>
                                <td class="p-2">${data.Scenario}</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-2 font-semibold">원천 유가 (WTI)</td>
                                <td class="p-2">$${parseFloat(data.Pred_WTI).toFixed(2)}</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-2 font-semibold">ABS 제조 원가</td>
                                <td class="p-2">$${parseFloat(data.Pred_ABS).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-semibold text-red-600">최종 도착가 (Landed)</td>
                                <td class="p-2 text-red-600 font-bold">$${parseFloat(data.Landed_Cost).toFixed(2)}</td>
                            </tr>
                        `;
                    }
                },
                error: function() {
                    console.error("CSV 파일을 찾을 수 없습니다. 시뮬레이션을 먼저 실행하세요.");
                }
            });

            // 이미지 캐시 방지를 위해 타임스탬프 추가
            document.getElementById('risk-chart').src = "risk_simulation_report.png?t=" + new Date().getTime();
        }

        // 페이지 로드 시 대시보드 업데이트 실행
        window.onload = updateDashboard;
    </script>
</body>
</html>
