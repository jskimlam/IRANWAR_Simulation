<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iran Risk Ã— ABS/SM ì›ê°€ ëŒ€ì‘ ëŒ€ì‹œë³´ë“œ v6.2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: 'Pretendard','Apple SD Gothic Neo',sans-serif; background:#0f172a; color:#e2e8f0; }
    @keyframes pulse-red { 0%,100%{opacity:1} 50%{opacity:0.4} }
    .alert-blink { animation: pulse-red 1.4s ease-in-out infinite; }
    #wti-price { font-size:3.2rem; font-weight:900; letter-spacing:-0.03em; transition:color 0.4s; }
    input[type=range] { -webkit-appearance:none; height:6px; border-radius:3px; background:#334155; outline:none; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:20px; height:20px; border-radius:50%; background:#f59e0b; cursor:pointer; }
    .metric-card { background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:1rem; padding:1.1rem 1.3rem; transition:border-color 0.3s; }
    .metric-card:hover { border-color:rgba(255,255,255,0.2); }
    .scenario-row { background:rgba(255,255,255,0.03); border-radius:0.75rem; padding:0.7rem 1rem; border-left:4px solid transparent; }
    .badge-ok    { background:#065f46; color:#6ee7b7; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }
    .badge-warn  { background:#78350f; color:#fcd34d; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }
    .badge-danger{ background:#7f1d1d; color:#fca5a5; border-radius:0.4rem; padding:2px 8px; font-size:0.75rem; font-weight:700; }
    #toast { position:fixed; top:1.5rem; right:1.5rem; z-index:9999; display:none; background:#7f1d1d; border:1px solid #ef4444; border-radius:0.75rem; padding:1rem 1.5rem; max-width:340px; }
    .sens-card { background:#0f172a; border-radius:0.5rem; padding:0.75rem; border:1px solid #334155; text-align:center; }
  </style>
</head>
<body class="p-4 md:p-8">

<div id="toast">
  <div class="text-red-400 font-black text-sm mb-1">âš  ABS ë§ˆì§„ ê²½ë³´</div>
  <div id="toast-msg" class="text-white text-sm"></div>
  <button onclick="document.getElementById('toast').style.display='none'" class="mt-2 text-xs text-red-300 underline">ë‹«ê¸°</button>
</div>

<div class="max-w-7xl mx-auto space-y-5">

  <!-- í—¤ë” -->
  <header class="bg-gradient-to-r from-red-950 to-slate-900 p-6 rounded-2xl border border-red-800/40 shadow-2xl">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div>
        <h1 class="text-2xl md:text-3xl font-black text-yellow-400 tracking-tight">
          ğŸ”´ IRAN CONFLICT Â· ABS/SM COST DASHBOARD <span class="text-base text-red-400 ml-2">v6.2</span>
        </h1>
        <p class="text-slate-400 text-sm mt-1">
          LAM Advanced Procurement  |  WTI CL=F ì‹¤ì‹œê°„  |  êµ¬ê¸€ì‹œíŠ¸ ì‹¤ì¸¡ê°€ ìë™ ë°˜ì˜
          <span class="text-yellow-600 ml-2">â˜… ë¦¬ìŠ¤í¬â†’WTIë“±ê°€ ì „ ì›ë£Œ ë°˜ì˜ | ì‹¤ì¸¡vsì´ë¡  ìˆ˜ê¸‰ì‹ í˜¸</span>
        </p>
      </div>
      <div class="text-right text-xs text-slate-500 space-y-0.5">
        <div id="update-time">ì—…ë°ì´íŠ¸ ì¤‘...</div>
        <div id="gs-date" class="text-yellow-600"></div>
        <div id="wti-source"></div>
      </div>
    </div>
    <div class="mt-5 flex flex-wrap items-end gap-6">
      <div>
        <div class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-1">WTI Crude Oil (CL=F)</div>
        <div id="wti-price" class="text-yellow-400">$--.-</div>
        <div id="wti-delta" class="text-xs mt-1"></div>
      </div>
      <div class="flex gap-4 pb-2">
        <div>
          <div class="text-xs text-slate-500">ABS Gap</div>
          <div id="hdr-abs-gap" class="text-2xl font-black text-emerald-400">$---</div>
        </div>
        <div>
          <div class="text-xs text-slate-500">SM Margin</div>
          <div id="hdr-sm-margin" class="text-2xl font-black text-red-400">$---</div>
        </div>
        <!-- â˜… v6.2 ìˆ˜ê¸‰ ì‹ í˜¸ í—¤ë” -->
        <div>
          <div class="text-xs text-yellow-600">ìˆ˜ê¸‰ì‹ í˜¸(ì‹¤ì¸¡-ì´ë¡ )</div>
          <div id="hdr-supply-signal" class="text-2xl font-black text-yellow-400">---</div>
        </div>
        <div>
          <div class="text-xs text-slate-500">BZ Korea-ARA</div>
          <div id="hdr-bz-spread" class="text-2xl font-black text-purple-400">$---</div>
        </div>
      </div>
      <div id="alert-badge" class="pb-2"><span class="badge-warn">ë¡œë”© ì¤‘</span></div>
    </div>
  </header>

  <!-- â˜… v6.2 ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ ì›ë¦¬ ì„¤ëª… ë°°ë„ˆ -->
  <div class="bg-yellow-950/40 border border-yellow-700/50 rounded-xl p-4 text-xs text-yellow-300 leading-relaxed">
    <span class="font-black text-yellow-400">â˜… v6.2 ì´ë€ ë¦¬ìŠ¤í¬ ë°˜ì˜ ì›ë¦¬:</span>
    ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ â†’ NAP ë¯¼ê°ë„(Ã·<span id="nap-sens-basis">6.52</span>) â†’ WTI ë“±ê°€ í™˜ì‚° â†’
    ì „ ì›ë£Œ(BZ/ET/BD/AN/NAP/PR) íšŒê·€ ë¯¼ê°ë„ë¡œ ì›ê°€ ìƒìŠ¹ ë°˜ì˜.
    <span class="text-orange-400 font-bold">ë¦¬ìŠ¤í¬â†‘ = ì›ê°€ë„ í•¨ê»˜ ìƒìŠ¹ = Gap ê°œì„  ì°©ì‹œ ì œê±°.</span>
    ìˆ˜ìš” ì—†ëŠ” ì§€ì •í•™ ë¦¬ìŠ¤í¬ëŠ” Gapì„ ì•…í™”ì‹œí‚´.
    <span id="risk-equiv-display" class="text-white font-bold ml-2"></span>
  </div>

  <!-- ì‹¤ì‹œê°„ ì‚°ì¶œê°’ -->
  <section>
    <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-3">
      ğŸ“¡ ì‹¤ì‹œê°„ ì‚°ì¶œê°’ (êµ¬ê¸€ì‹œíŠ¸ ì‹¤ì¸¡ + WTI ë¸íƒ€ ë³´ì •) â€” v6.2
    </h2>
    <div class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-10 gap-3">
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">WTI ì‹¤ì‹œê°„</div>
        <div id="c-wti" class="text-lg font-black text-yellow-400">--</div>
        <div class="text-xs text-slate-600">$/bbl</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">Naphtha(ê¸°ì¤€)</div>
        <div id="c-nap" class="text-lg font-black text-slate-300">--</div>
        <div class="text-xs text-slate-600">$/mt MOPJ</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">BZ FOB Korea</div>
        <div id="c-bz" class="text-lg font-black text-purple-400">--</div>
        <div id="c-bz-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">ET CFR NEA</div>
        <div id="c-et" class="text-lg font-black text-green-400">--</div>
        <div id="c-et-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">BD CFR China</div>
        <div id="c-bd" class="text-lg font-black text-orange-400">--</div>
        <div id="c-bd-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">AN CFR FEA</div>
        <div id="c-an" class="text-lg font-black text-yellow-400">--</div>
        <div id="c-an-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card border border-cyan-900/50">
        <div class="text-xs text-cyan-500 mb-1 font-bold">PR CFR China</div>
        <div id="c-pr" class="text-lg font-black text-cyan-400">--</div>
        <div id="c-pr-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">SM CFR China</div>
        <div id="c-sm-mkt" class="text-lg font-black text-blue-400">--</div>
        <div id="c-sm-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">SM Margin</div>
        <div id="c-sm-margin" class="text-lg font-black text-red-400">--</div>
        <div class="text-xs text-slate-600">WTI ë¬´ìƒê´€</div>
      </div>
      <div class="metric-card">
        <div class="text-xs text-slate-500 mb-1">ABS Market</div>
        <div id="c-abs-mkt" class="text-lg font-black text-blue-300">--</div>
        <div id="c-abs-mkt-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
    </div>

    <!-- í•µì‹¬ ì§€í‘œ í–‰ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
      <div class="metric-card border border-red-900/50">
        <div class="text-xs text-slate-500 mb-1">ABS Cost</div>
        <div id="c-abs-cost" class="text-xl font-black text-red-400">--</div>
        <div id="c-abs-cost-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="metric-card border border-emerald-800/80">
        <div class="text-xs text-slate-500 mb-1">ABS Gap â˜…</div>
        <div id="c-abs-gap" class="text-xl font-black text-emerald-400">--</div>
        <div class="text-xs text-slate-600">Market - Cost</div>
      </div>
      <!-- â˜… v6.2 ìˆ˜ê¸‰ì‹ í˜¸ ì¹´ë“œ -->
      <div class="metric-card border border-yellow-800/60">
        <div class="text-xs text-yellow-600 mb-1 font-bold">SM ìˆ˜ê¸‰ì‹ í˜¸ â˜… (ì‹¤ì¸¡-ì´ë¡ ì›ê°€)</div>
        <div id="c-supply-signal" class="text-xl font-black text-yellow-400">--</div>
        <div id="c-supply-signal-sub" class="text-xs text-slate-600">ì–‘ìˆ˜=ìˆ˜ê¸‰íƒ€ì´íŠ¸</div>
      </div>
      <div class="metric-card border border-indigo-900/50">
        <div class="text-xs text-indigo-400 mb-1 font-bold">BZ CIF ARA</div>
        <div id="c-bz-ara" class="text-xl font-black text-indigo-400">--</div>
        <div id="c-bz-ara-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
    </div>

    <!-- â˜… v6.2 SM ì‹¤ì¸¡ vs ì´ë¡  ë§ˆì§„ ë¹„êµ ì¹´ë“œ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
      <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-4">
        <div class="text-xs text-slate-400 mb-2 font-bold">SM Cost ì‹¤ì¸¡ (BZÃ—0.67+ETÃ—0.25+NAPÃ—0.05+150)</div>
        <div id="c-sm-cost" class="text-xl font-black text-red-400">--</div>
        <div id="c-sm-cost-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="bg-slate-800/40 border border-yellow-900/40 rounded-xl p-4">
        <div class="text-xs text-yellow-600 mb-2 font-bold">SM Cost ì´ë¡  (BZÃ—0.80+ETÃ—0.30+150)</div>
        <div id="c-sm-cost-theory" class="text-xl font-black text-yellow-400">--</div>
        <div id="c-sm-cost-theory-act" class="text-xs text-slate-600">ì‹¤ì¸¡ $---</div>
      </div>
      <div class="bg-slate-800/40 border border-slate-700 rounded-xl p-4">
        <div class="text-xs text-slate-400 mb-2 font-bold">SM Margin ì‹¤ì¸¡</div>
        <div id="c-sm-margin2" class="text-xl font-black">--</div>
        <div class="text-xs text-slate-600">ì‹¤ì¸¡ì›ê°€ ê¸°ë°˜</div>
      </div>
      <div class="bg-slate-800/40 border border-yellow-900/40 rounded-xl p-4">
        <div class="text-xs text-yellow-600 mb-2 font-bold">SM Margin ì´ë¡ </div>
        <div id="c-sm-margin-theory" class="text-xl font-black">--</div>
        <div class="text-xs text-slate-600">ì´ë¡ ì›ê°€ ê¸°ë°˜</div>
      </div>
    </div>
  </section>

  <!-- BZ ê¸€ë¡œë²Œ ìŠ¤í”„ë ˆë“œ -->
  <section class="bg-slate-800/40 border border-purple-800/40 rounded-2xl p-5">
    <h2 class="text-purple-400 text-xs font-bold tracking-widest uppercase mb-4">
      ğŸŒ BZ ê¸€ë¡œë²Œ ìŠ¤í”„ë ˆë“œ ë¶„ì„ (Korea / ARA / USG)
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
      <div class="bg-slate-900/60 rounded-xl p-4 border border-purple-900/50">
        <div class="text-purple-300 font-bold mb-3 text-xs uppercase">BZ Korea vs ARA</div>
        <div class="flex justify-between mb-1"><span class="text-slate-400">BZ FOB Korea</span><span id="sp-bz-korea" class="text-purple-400 font-black">$---</span></div>
        <div class="flex justify-between mb-1"><span class="text-slate-400">BZ CIF ARA</span><span id="sp-bz-ara" class="text-indigo-400 font-black">$---</span></div>
        <div class="flex justify-between pt-2 border-t border-slate-700">
          <span class="text-white font-bold">Spread (Korea-ARA)</span>
          <span id="sp-bz-spread-ara" class="font-black text-fuchsia-400">$---</span>
        </div>
        <div class="mt-2 text-xs text-slate-600">ì–‘ìˆ˜=Korea í”„ë¦¬ë¯¸ì—„ â†’ ì•„ì‹œì•„ ê°•ì„¸</div>
      </div>
      <div class="bg-slate-900/60 rounded-xl p-4 border border-amber-900/50">
        <div class="text-amber-300 font-bold mb-3 text-xs uppercase">BZ Korea vs USG</div>
        <div class="flex justify-between mb-1"><span class="text-slate-400">BZ FOB Korea</span><span id="sp-bz-korea2" class="text-purple-400 font-black">$---</span></div>
        <div class="flex justify-between mb-1"><span class="text-slate-400">BZ USG ($/mt í™˜ì‚°)</span><span id="sp-bz-usg" class="text-amber-400 font-black">$---</span></div>
        <div class="flex justify-between pt-2 border-t border-slate-700">
          <span class="text-white font-bold">Spread (Korea-USG)</span>
          <span id="sp-bz-spread-usg" class="font-black text-amber-400">$---</span>
        </div>
        <div class="mt-2 text-xs text-slate-600">â€» USG = cts/gal Ã— 26.42 í™˜ì‚°</div>
      </div>
      <div class="bg-slate-900/60 rounded-xl p-4 border border-slate-700">
        <div class="text-slate-300 font-bold mb-3 text-xs uppercase">ìŠ¤í”„ë ˆë“œ í•´ì„</div>
        <div id="bz-spread-insight" class="text-xs text-slate-400 leading-relaxed">CSV ë¡œë“œ í›„ ì—…ë°ì´íŠ¸</div>
        <div class="mt-3 text-xs text-slate-600 border-t border-slate-700 pt-2">
          <div>â€¢ Korea-ARA &gt; $50: ì•„ì‹œì•„ ìˆ˜ìš” ê°•ì„¸</div>
          <div>â€¢ Korea-ARA &lt; $0: ìœ ëŸ½ì‚° BZ ì—­ì „</div>
        </div>
      </div>
    </div>
  </section>

  <!-- WTI ìŠ¬ë¼ì´ë” ì‹œë®¬ë ˆì´í„° -->
  <section class="bg-slate-800/40 border border-slate-700 rounded-2xl p-5">
    <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-4">ğŸš ì¸í„°ë™í‹°ë¸Œ WTI ì‹œë®¬ë ˆì´í„° v6.2</h2>

    <!-- â˜… v6.2 WTI ë“±ê°€ ì‹¤ì‹œê°„ í‘œì‹œ -->
    <div id="risk-equiv-bar" class="mb-4 p-3 rounded-lg bg-yellow-950/40 border border-yellow-800/50 text-xs text-yellow-300 hidden">
      <span class="font-black">ë¦¬ìŠ¤í¬ WTI ë“±ê°€:</span>
      <span id="risk-equiv-val" class="text-white font-black mx-2">+$0/bbl</span>
      â†’ BZ +<span id="risk-bz-impact">$0</span> |
      ET +<span id="risk-et-impact">$0</span> |
      BD +<span id="risk-bd-impact">$0</span> |
      AN +<span id="risk-an-impact">$0</span> |
      NAP +<span id="risk-nap-impact">$0</span> |
      SM +<span id="risk-sm-impact">$0</span>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <div class="space-y-5">
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm text-slate-400 font-bold">WTI ìœ ê°€</label>
            <span id="slider-wti-val" class="text-yellow-400 font-black text-lg">$67.00 /bbl</span>
          </div>
          <input type="range" id="slider-wti" min="40" max="120" step="0.5" value="67" class="w-full" oninput="onSlider()">
          <div class="flex justify-between text-xs text-slate-600 mt-1">
            <span>$40</span><span>$60</span><span>$80</span><span>$100</span><span>$120</span>
          </div>
        </div>
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm text-slate-400 font-bold">ì´ë€ ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„</label>
            <span id="slider-risk-val" class="text-red-400 font-black text-lg">+$0 /t</span>
          </div>
          <input type="range" id="slider-risk" min="0" max="300" step="10" value="0" class="w-full" oninput="onSlider()">
          <div class="flex justify-between text-xs text-slate-600 mt-1">
            <span>Base</span><span>+$75</span><span>+$150</span><span>+$225</span><span>+$300</span>
          </div>
        </div>
        <div class="flex flex-wrap gap-2">
          <button onclick="setScenario(59.44,0)"   class="text-xs bg-emerald-900/60 text-emerald-400 border border-emerald-700 rounded-lg px-3 py-1.5 hover:bg-emerald-800 transition">Base $59</button>
          <button onclick="setScenario(70,50)"     class="text-xs bg-amber-900/60   text-amber-400   border border-amber-700   rounded-lg px-3 py-1.5 hover:bg-amber-800   transition">Mild $70</button>
          <button onclick="setScenario(80,100)"    class="text-xs bg-orange-900/60  text-orange-400  border border-orange-700  rounded-lg px-3 py-1.5 hover:bg-orange-800  transition">Moderate $80</button>
          <button onclick="setScenario(90,150)"    class="text-xs bg-red-900/60     text-red-400     border border-red-700     rounded-lg px-3 py-1.5 hover:bg-red-800     transition">Severe $90</button>
          <button onclick="setScenario(100,200)"   class="text-xs bg-red-950/80     text-red-300     border border-red-900     rounded-lg px-3 py-1.5 hover:bg-red-900     transition">Crisis $100</button>
        </div>
      </div>

      <div class="space-y-2 text-sm">
        <div class="grid grid-cols-2 gap-2">
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-slate-400">BZ</span><span id="sim-bz" class="text-purple-400 font-black">$---</span></div>
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-slate-400">ET</span><span id="sim-et" class="text-green-400 font-black">$---</span></div>
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-slate-400">BD</span><span id="sim-bd" class="text-orange-400 font-black">$---</span></div>
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-slate-400">AN</span><span id="sim-an" class="text-yellow-400 font-black">$---</span></div>
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-cyan-500 font-bold">PR</span><span id="sim-pr" class="text-cyan-400 font-black">$---</span></div>
          <div class="flex justify-between border-b border-slate-700 pb-2"><span class="text-slate-400">SM Market</span><span id="sim-sm-mkt" class="text-blue-400 font-black">$---</span></div>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-slate-400">SM Cost ì‹¤ì¸¡ <span class="text-slate-600 text-xs">(BZÃ—0.67+ETÃ—0.25+NAPÃ—0.05+150)</span></span>
          <span id="sim-sm-cost" class="text-red-400 font-black">$---</span>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-yellow-600">SM Cost ì´ë¡  <span class="text-slate-600 text-xs">(BZÃ—0.80+ETÃ—0.30+150)</span></span>
          <span id="sim-sm-cost-theory" class="text-yellow-400 font-black">$---</span>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-slate-400">SM Margin ì‹¤ì¸¡</span>
          <span id="sim-sm-margin" class="font-black">$---</span>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-yellow-600">ìˆ˜ê¸‰ì‹ í˜¸(ì‹¤ì¸¡-ì´ë¡ )</span>
          <span id="sim-supply-signal" class="font-black">---</span>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-slate-400">ABS Market (ë¦¬ìŠ¤í¬ í¬í•¨)</span>
          <span id="sim-abs-mkt" class="text-orange-400 font-black">$---</span>
        </div>
        <div class="flex justify-between border-b border-slate-700 pb-2">
          <span class="text-slate-400">ABS Cost <span class="text-slate-600 text-xs">(ì›ë£ŒìƒìŠ¹ ë°˜ì˜)</span></span>
          <span id="sim-abs-cost" class="text-red-400 font-black">$---</span>
        </div>
        <div class="flex justify-between pt-1">
          <span class="text-white font-black">ABS GAP (ë§ˆì§„)</span>
          <span id="sim-abs-gap" class="font-black text-2xl">$---</span>
        </div>
        <div id="strategy-box" class="mt-4 p-3 rounded-lg bg-slate-800 border border-slate-600 text-xs leading-relaxed text-slate-400">
          ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì‘í•˜ì—¬ êµ¬ë§¤ ì „ëµ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
        </div>
      </div>
    </div>
  </section>

  <!-- 5ë‹¨ê³„ ì‹œë‚˜ë¦¬ì˜¤ -->
  <section class="bg-slate-800/40 border border-slate-700 rounded-2xl p-5">
    <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase mb-4">ğŸ“Š 5ë‹¨ê³„ ì´ë€ ë¦¬ìŠ¤í¬ ì‹œë‚˜ë¦¬ì˜¤ v6.2 (ë¦¬ìŠ¤í¬â†’ì „ ì›ë£Œ WTI ë“±ê°€ ë°˜ì˜)</h2>
    <div class="space-y-2" id="scenario-table"></div>
    <div class="mt-3 text-xs text-slate-600">
      â˜… v6.2: ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ â†’ NAP ë¯¼ê°ë„ë¡œ WTI ë“±ê°€ í™˜ì‚° â†’ ì „ ì›ë£Œ íšŒê·€ ë°˜ì˜ â†’ ABS Cost ìƒìŠ¹ â†’ Gap í˜„ì‹¤ ë°˜ì˜
      <br>* ABS Market = ì‹¤ì¸¡ + WTI íšŒê·€ + ë¦¬ìŠ¤í¬ flat | ABS Cost = ì‹¤ì¸¡ ì›ë£Œ + total WTI ë¸íƒ€(ì‹¤ì‹œê°„+ë¦¬ìŠ¤í¬ë“±ê°€) Ã— íšŒê·€
    </div>
  </section>

  <!-- ì°¨íŠ¸ -->
  <section class="bg-white/[0.03] border border-white/10 rounded-2xl p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-slate-300 font-black text-sm uppercase tracking-widest border-l-4 border-red-600 pl-3">
        ğŸ“ˆ VISUALIZED REPORT (9íŒ¨ë„ v6.2)
      </h2>
      <button onclick="refreshImg()" class="text-xs text-slate-400 border border-slate-700 rounded-lg px-3 py-1.5 hover:bg-slate-700 transition">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <img id="report-img" src="risk_simulation_report.png"
         class="w-full h-auto rounded-xl border border-slate-700"
         onerror="this.style.opacity='0.2'">
  </section>

  <!-- Calculation Logic -->
  <section class="bg-slate-800/30 border border-slate-700 rounded-2xl p-5">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-slate-400 text-xs font-bold tracking-widest uppercase">âš™ Calculation Logic v6.2</h2>
      <div id="reg-meta" class="text-xs text-slate-600"></div>
    </div>
    <div class="grid md:grid-cols-3 gap-4 text-xs text-slate-400 leading-loose mb-5">
      <div class="bg-slate-900/60 rounded-xl p-4 border border-yellow-900/40">
        <div class="text-yellow-300 font-bold mb-2">â˜… v6.2 ë¦¬ìŠ¤í¬ WTI ë“±ê°€ ê³µì‹</div>
        <div>wti_equiv = risk_premium Ã· NAP_sens(<span id="logic-nap-sens">6.52</span>)</div>
        <div class="text-slate-500">NAP RÂ²=0.880 ìµœê³  â†’ WTI í™˜ì‚° ê¸°ì¤€</div>
        <div class="mt-2">total_delta = WTI_delta + wti_equiv</div>
        <div>ê° ì›ë£Œ = ì‹¤ì¸¡ + total_delta Ã— íšŒê·€ë¯¼ê°ë„</div>
        <div class="mt-2 text-orange-400 font-bold">ë¦¬ìŠ¤í¬$100 â‰¡ WTI +$<span id="logic-equiv-100">15.3</span>/bbl</div>
        <div class="text-slate-500">â†’ BZ +${Math.round(100/6.52*16.81)}, ET +${Math.round(100/6.52*6.13)} ë“± ì „íŒŒ</div>
      </div>
      <div class="bg-slate-900/60 rounded-xl p-4 border border-purple-900/40">
        <div class="text-purple-300 font-bold mb-2">SM Cost ì‹¤ì¸¡ vs ì´ë¡ </div>
        <div class="text-red-400">ì‹¤ì¸¡: BZÃ—0.67 + ETÃ—0.25 + NAPÃ—0.05 + 150</div>
        <div class="text-yellow-400">ì´ë¡ : BZÃ—0.80 + ETÃ—0.30 + 150</div>
        <div class="mt-2 text-slate-300">ìˆ˜ê¸‰ì‹ í˜¸ = ì‹¤ì¸¡ì›ê°€ - ì´ë¡ ì›ê°€</div>
        <div class="text-slate-500">ì–‘ìˆ˜: ìˆ˜ê¸‰ íƒ€ì´íŠ¸ (ì‹¤ì¸¡ì›ê°€ > ì´ë¡ )</div>
        <div class="text-slate-500">ìŒìˆ˜: ìˆ˜ê¸‰ ì—¬ìœ  (ì‹¤ì¸¡ì›ê°€ < ì´ë¡ )</div>
        <div class="mt-2 text-slate-600">SM Margin: WTI ë¬´ìƒê´€(RÂ²â‰ˆ0)</div>
      </div>
      <div class="bg-slate-900/60 rounded-xl p-4 border border-slate-700">
        <div class="text-slate-300 font-bold mb-2">ABS Gap v6.2</div>
        <div>ABS Market = ì‹¤ì¸¡ + WTIíšŒê·€ + ë¦¬ìŠ¤í¬(flat)</div>
        <div>ABS Cost = ì‹¤ì¸¡ + total_delta Ã— íšŒê·€</div>
        <div class="mt-2 text-emerald-400">ABS Gap = Market - Cost</div>
        <div class="mt-1 text-slate-500">ë¦¬ìŠ¤í¬â†‘ â†’ ì›ê°€ë„â†‘ â†’ Gap ì•…í™”</div>
        <div class="text-slate-500">(v6.1 ì°©ì‹œ ì œê±°: í”„ë¦¬ë¯¸ì—„ë§Œí¼ ê°œì„  X)</div>
        <div class="mt-2">ABS Cost = SMÃ—0.60 + ANÃ—0.25 + BDÃ—0.15</div>
      </div>
    </div>

    <!-- ë¯¼ê°ë„ ì¹´ë“œ -->
    <div>
      <div class="text-slate-300 text-xs font-bold mb-3 flex items-center gap-2">
        ğŸ“ˆ WTI ë¯¼ê°ë„ ì „ í’ˆëª©
        <span class="text-slate-600 font-normal">â€” WTI $1/bbl ë³€ë™ ì‹œ ë³€í™”ëŸ‰ ($/mt)</span>
        <span id="reg-n-badge" class="bg-slate-700 text-slate-300 px-2 py-0.5 rounded text-xs"></span>
      </div>
      <div class="grid grid-cols-3 md:grid-cols-7 gap-2 mb-2">
        <div class="sens-card border border-slate-600">
          <div class="text-xs text-slate-300 font-bold mb-1">NAP(ê¸°ì¤€)</div>
          <div id="sens-nap"  class="text-lg font-black text-white">---</div>
          <div id="r2-nap"    class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-purple-400 font-bold mb-1">BZ</div>
          <div id="sens-bz"   class="text-lg font-black text-white">---</div>
          <div id="r2-bz"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-green-400 font-bold mb-1">ET</div>
          <div id="sens-et"   class="text-lg font-black text-white">---</div>
          <div id="r2-et"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-blue-400 font-bold mb-1">SM</div>
          <div id="sens-sm"   class="text-lg font-black text-white">---</div>
          <div id="r2-sm"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-orange-400 font-bold mb-1">BD</div>
          <div id="sens-bd"   class="text-lg font-black text-white">---</div>
          <div id="r2-bd"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-yellow-400 font-bold mb-1">AN</div>
          <div id="sens-an"   class="text-lg font-black text-white">---</div>
          <div id="r2-an"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card border border-cyan-900/60">
          <div class="text-xs text-cyan-400 font-bold mb-1">PR</div>
          <div id="sens-pr"   class="text-lg font-black text-white">---</div>
          <div id="r2-pr"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
      </div>
      <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
        <div class="sens-card border border-red-900/50">
          <div class="text-xs text-red-400 font-bold mb-1">ABS Gap â˜…â˜…</div>
          <div id="sens-abs_gap"  class="text-lg font-black text-white">---</div>
          <div id="r2-abs_gap"    class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-cyan-400 font-bold mb-1">ABS Mkt</div>
          <div id="sens-abs_mkt"  class="text-lg font-black text-white">---</div>
          <div id="r2-abs_mkt"    class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-pink-400 font-bold mb-1">ABS Cost</div>
          <div id="sens-abs_cost" class="text-lg font-black text-white">---</div>
          <div id="r2-abs_cost"   class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card border border-indigo-900/50">
          <div class="text-xs text-indigo-400 font-bold mb-1">BZ ARA</div>
          <div id="sens-bz_ara"   class="text-lg font-black text-white">---</div>
          <div id="r2-bz_ara"     class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-slate-400 font-bold mb-1">SM Cost</div>
          <div id="sens-sm_cost"  class="text-lg font-black text-white">---</div>
          <div id="r2-sm_cost"    class="text-xs text-slate-600 mt-1">RÂ²=---</div>
        </div>
        <div class="sens-card">
          <div class="text-xs text-slate-500 font-bold mb-1">SM Margin</div>
          <div id="sens-sm_margin" class="text-lg font-black text-green-400">â‰ˆ0</div>
          <div class="text-xs text-slate-600 mt-1">WTI ë¬´ìƒê´€</div>
        </div>
      </div>
      <div class="mt-3 text-xs text-slate-600">
        â˜… NAP RÂ²=0.880 ìµœê³  â†’ ë¦¬ìŠ¤í¬ WTI ë“±ê°€ í™˜ì‚° ê¸°ì¤€ | ABS Gap: WTI $1â†‘ â†’ -$5.76â†“ | SM Margin: WTI ë¬´ìƒê´€(RÂ²â‰ˆ0)
        <br>â˜… v6.2: ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ â†’ wti_equiv = ë¦¬ìŠ¤í¬ Ã· NAP_sens â†’ ì „ ì›ë£Œ íšŒê·€ ë°˜ì˜ â†’ Gap í˜„ì‹¤ ì•…í™” êµ¬ì¡°
      </div>
    </div>
  </section>

  <footer class="text-center text-slate-700 text-xs pb-4">
    LAM Advanced Procurement Team 1  |  v6.2  |  ë¦¬ìŠ¤í¬â†’WTIë“±ê°€ ì „ ì›ë£Œ ë°˜ì˜  |  ì‹¤ì¸¡vsì´ë¡  ìˆ˜ê¸‰ì‹ í˜¸  |  30ì´ˆ ìë™ê°±ì‹ 
  </footer>
</div>

<script>
// â”€â”€ ìƒíƒœ
let G = {
  wti_gs:67.02, wti_rt:67.02,
  bz:772.67, et:710.0, bd:1270.0, an:1315.0, nap:637.0,
  sm_act:966.5, abs_mkt_act:1060.0,
  pr_act:870.0, bz_ara_act:720.0, bz_usg_mt_act:680.0,
  sm_cost_act:968.0, sm_margin_act:-1.0,
  sm_cost_theory_act:950.0, sm_margin_theory_act:16.0,
  sm_cost_gap_signal_act:18.0,
  abs_cost_act:1099.0, abs_gap_act:-39.0,
};

let SENS = {
  bz:16.81, et:6.13, bd:20.48, an:7.87, sm:14.75,
  nap:6.52,     // â˜… WTI ë“±ê°€ í™˜ì‚° ê¸°ì¤€
  pr:4.18,
  bz_ara:15.20, bz_usg:0.85,
  sm_cost:14.50, sm_margin:-0.08,
  abs_cost:13.89, abs_mkt:8.12, abs_gap:-5.76,
};

// â˜… v6.2 í•µì‹¬: ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ â†’ WTI ë“±ê°€ í™˜ì‚° ê¸°ì¤€
let NAP_SENS_EQUIV = SENS.nap;
const BZ_USG_TO_MT = 26.42;
const SM_THEORY = { bz: 0.80, et: 0.30, fixed: 150 };

function fmt(v, sign=false) {
  if (v===null||v===undefined||isNaN(v)) return '--';
  return (sign&&v>=0?'+':'') + '$' + Math.round(v).toLocaleString();
}

// â”€â”€ â˜… v6.2 í•µì‹¬ ê³„ì‚° í•¨ìˆ˜
// ë¦¬ìŠ¤í¬ í”„ë¦¬ë¯¸ì—„ â†’ WTI ë“±ê°€ â†’ ì „ ì›ë£Œ íšŒê·€ ë°˜ì˜
function calcFromG(wti, risk=0) {
  const d_wti = wti - G.wti_gs;

  // â˜… ë¦¬ìŠ¤í¬ â†’ WTI ë“±ê°€
  const wti_risk_equiv = risk / NAP_SENS_EQUIV;

  // â˜… ì „ ì›ë£Œì— ì ìš©ë˜ëŠ” ì´ WTI ë¸íƒ€
  const d_total = d_wti + wti_risk_equiv;

  // ì „ ì›ë£Œ ë³´ì •
  const bz   = G.bz    + d_total * SENS.bz;
  const et   = G.et    + d_total * SENS.et;
  const bd   = G.bd    + d_total * SENS.bd;
  const an   = G.an    + d_total * SENS.an;
  const nap  = G.nap   + d_total * SENS.nap;
  const sm   = G.sm_act + d_total * SENS.sm;
  const pr   = G.pr_act + d_total * SENS.pr;

  // BZ ê¸€ë¡œë²Œ
  const bzAra    = G.bz_ara_act   + d_total * SENS.bz_ara;
  const bzUsgMt  = G.bz_usg_mt_act + d_total * SENS.bz_usg * BZ_USG_TO_MT;
  const bzSpreadAra = bz - bzAra;
  const bzSpreadUsg = bz - bzUsgMt;

  // SM Cost ì‹¤ì¸¡ íšŒê·€ ê¸°ë°˜
  const smC  = G.sm_cost_act + d_total * SENS.sm_cost;
  // SM Margin: WTI ë¬´ìƒê´€ â†’ ì‹¤ì‹œê°„ WTI ë¸íƒ€ë§Œ ì ìš© (ë¦¬ìŠ¤í¬ ë“±ê°€ ì œì™¸)
  const smM  = G.sm_margin_act + d_wti * SENS.sm_margin;

  // SM Cost ì´ë¡  ê¸°ì¤€ì„  (ë³´ì •ëœ BZ/ET ì‚¬ìš©)
  const smCTheory = bz * SM_THEORY.bz + et * SM_THEORY.et + SM_THEORY.fixed;
  const smMTheory = sm - smCTheory;
  // ìˆ˜ê¸‰ì‹ í˜¸: ì‹¤ì¸¡ì›ê°€ - ì´ë¡ ì›ê°€
  const supplySignal = smC - smCTheory;

  // ABS Cost (ì›ë£Œ ìƒìŠ¹ ë°˜ì˜)
  const absC = G.abs_cost_act + d_total * SENS.abs_cost;
  // ABS Market: ì‹¤ì‹œê°„ WTI íšŒê·€ + ë¦¬ìŠ¤í¬ flat
  const absM = G.abs_mkt_act + d_wti * SENS.abs_mkt + risk;
  // ABS Gap = Market - Cost (ì°©ì‹œ ì œê±°)
  const absG = absM - absC;

  return {
    wti, d_wti, wti_risk_equiv, d_total, risk,
    bz, et, bd, an, nap, sm, pr, bzAra, bzUsgMt,
    bzSpreadAra, bzSpreadUsg,
    smC, smM, smCTheory, smMTheory, supplySignal,
    absC, absM, absG
  };
}

function alertBadge(absG, smM) {
  if (absG < 0 || smM < -100) return `<span class="badge-danger alert-blink">ğŸ”´ CRITICAL</span>`;
  if (absG < 150)              return `<span class="badge-warn">ğŸŸ¡ WARNING - Gap ${Math.round(absG)}/t</span>`;
  return `<span class="badge-ok">ğŸŸ¢ NORMAL</span>`;
}

function strategy(r) {
  if (r.absG < 0)          return `<span class="text-red-400 font-bold">ğŸ”´ ì—­ë§ˆì§„ ì „í™˜ â€” ì¦‰ì‹œ í˜‘ìƒ ì¬ì¡°ì •. ê³„ì•½ ì—°ì¥ ê¸ˆì§€.</span>`;
  if (r.absG < 100)        return `<span class="text-orange-400 font-bold">ğŸŸ  GAP ìœ„í—˜ â€” ë‹¨ê°€ ì¸í•˜ ìš”ì²­ or íŒë§¤ê°€ ì¸ìƒ.</span>`;
  if (r.absG < 200)        return `<span class="text-yellow-400">ğŸŸ¡ GAP ì¶•ì†Œ â€” ì ì • ì¬ê³  ìœ ì§€. WTI $80 ëŒíŒŒ ì‹œ ì¦‰ì‹œ ì¬í‰ê°€.</span>`;
  if (r.supplySignal > 50) return `<span class="text-orange-400">ğŸŸ  ìˆ˜ê¸‰ íƒ€ì´íŠ¸ ì‹ í˜¸(+${Math.round(r.supplySignal)}) â€” SM ë©”ì´ì»¤ ê³µê¸‰ ì œí•œ ê°€ëŠ¥. ì„ ì œ ì¬ê³  ê²€í† .</span>`;
  if (r.smM < 0)           return `<span class="text-blue-400">ğŸ”µ SM ì—­ë§ˆì§„ â€” ë©”ì´ì»¤ ê°ì‚° â†’ ìˆ˜ê¸‰ íƒ€ì´íŠ¸ ì˜ˆìƒ.</span>`;
  return `<span class="text-emerald-400">ğŸŸ¢ ì •ìƒ ë²”ìœ„ â€” í˜„í–‰ êµ¬ë§¤ ì „ëµ ìœ ì§€.</span>`;
}

function bzSpreadInsight(sAra, sUsg) {
  let msg = '';
  if (isNaN(sAra)) {
    msg += '<div class="text-slate-500">BZ ARA ë°ì´í„° ì—†ìŒ</div>';
  } else if (sAra > 50) {
    msg += `<div class="text-emerald-400 font-bold">âœ… Korea-ARA: ${fmt(sAra,true)} â€” ì•„ì‹œì•„ ê°•ì„¸. ìˆ˜ì¶œ ìœ ë¦¬.</div>`;
  } else if (sAra > 0) {
    msg += `<div class="text-yellow-400">âš  Korea-ARA: ${fmt(sAra,true)} â€” ì†Œí­ í”„ë¦¬ë¯¸ì—„.</div>`;
  } else {
    msg += `<div class="text-red-400 font-bold">ğŸ”´ Korea-ARA: ${fmt(sAra,true)} â€” ARA ì—­ì „. ìœ ëŸ½ì‚° ê²½ìŸë ¥ ìš°ìœ„.</div>`;
  }
  if (!isNaN(sUsg)) msg += `<div class="mt-2 text-slate-400">Korea-USG: ${fmt(sUsg,true)}/mt</div>`;
  return msg;
}

// ì‹œë‚˜ë¦¬ì˜¤
const SCENARIOS = [
  {label:'Base',     wti:59.44, risk:0,   color:'#10b981'},
  {label:'Mild',     wti:70,    risk:50,  color:'#f59e0b'},
  {label:'Moderate', wti:80,    risk:100, color:'#f97316'},
  {label:'Severe',   wti:90,    risk:150, color:'#ef4444'},
  {label:'Crisis',   wti:100,   risk:200, color:'#b91c1c'},
];

function renderScenarios() {
  document.getElementById('scenario-table').innerHTML = SCENARIOS.map(s => {
    const r  = calcFromG(s.wti, s.risk);
    const gc = r.absG < 0 ? '#ef4444' : r.absG < 150 ? '#f59e0b' : '#10b981';
    const sc = r.supplySignal > 30 ? '#f97316' : r.supplySignal > 0 ? '#f59e0b' : '#10b981';
    const we = r.wti_risk_equiv;
    return `<div class="scenario-row" style="border-left-color:${s.color}">
      <div class="flex flex-wrap items-center gap-2 text-xs md:text-sm">
        <span class="font-black w-20" style="color:${s.color}">${s.label}</span>
        <span class="text-slate-400 w-16">WTI <b class="text-white">$${s.wti}</b></span>
        <span class="text-slate-400 w-20">Risk <b class="text-orange-400">+$${s.risk}</b></span>
        <span class="text-yellow-600 w-24">â‰¡WTI <b class="text-yellow-400">+$${we.toFixed(1)}</b></span>
        <span class="text-slate-400 w-28">BZ <b class="text-purple-300">${fmt(r.bz)}</b></span>
        <span class="text-slate-400 w-24">SM <b class="text-blue-300">${fmt(r.sm)}</b></span>
        <span class="text-cyan-500 w-24">PR <b class="text-cyan-400">${fmt(r.pr)}</b></span>
        <span class="text-slate-400 w-32">ABS Mkt <b class="text-blue-200">${fmt(r.absM)}</b></span>
        <span class="text-slate-400 w-32">ABS Cost <b class="text-red-300">${fmt(r.absC)}</b></span>
        <span class="w-32">ABS Gap <b style="color:${gc}" class="font-black">${fmt(r.absG,true)}</b></span>
        <span class="w-32">ìˆ˜ê¸‰ì‹ í˜¸ <b style="color:${sc}">${r.supplySignal >= 0 ? '+' : ''}${Math.round(r.supplySignal)}/t</b></span>
      </div>
    </div>`;
  }).join('');
}

// ìŠ¬ë¼ì´ë”
function onSlider() {
  const wti  = parseFloat(document.getElementById('slider-wti').value);
  const risk = parseFloat(document.getElementById('slider-risk').value);
  document.getElementById('slider-wti-val').textContent  = `$${wti.toFixed(2)} /bbl`;
  document.getElementById('slider-risk-val').textContent = `+$${risk} /t`;

  const r = calcFromG(wti, risk);

  // â˜… v6.2 ë¦¬ìŠ¤í¬ WTI ë“±ê°€ í‘œì‹œ ë°”
  const riskBar = document.getElementById('risk-equiv-bar');
  if (risk > 0) {
    riskBar.classList.remove('hidden');
    document.getElementById('risk-equiv-val').textContent = `+$${r.wti_risk_equiv.toFixed(1)}/bbl`;
    document.getElementById('risk-bz-impact').textContent  = `$${Math.round(r.wti_risk_equiv * SENS.bz)}`;
    document.getElementById('risk-et-impact').textContent  = `$${Math.round(r.wti_risk_equiv * SENS.et)}`;
    document.getElementById('risk-bd-impact').textContent  = `$${Math.round(r.wti_risk_equiv * SENS.bd)}`;
    document.getElementById('risk-an-impact').textContent  = `$${Math.round(r.wti_risk_equiv * SENS.an)}`;
    document.getElementById('risk-nap-impact').textContent = `$${Math.round(r.wti_risk_equiv * SENS.nap)}`;
    document.getElementById('risk-sm-impact').textContent  = `$${Math.round(r.wti_risk_equiv * SENS.sm)}`;
  } else {
    riskBar.classList.add('hidden');
  }

  document.getElementById('sim-bz').textContent       = fmt(r.bz);
  document.getElementById('sim-et').textContent       = fmt(r.et);
  document.getElementById('sim-bd').textContent       = fmt(r.bd);
  document.getElementById('sim-an').textContent       = fmt(r.an);
  document.getElementById('sim-pr').textContent       = fmt(r.pr);
  document.getElementById('sim-sm-mkt').textContent   = fmt(r.sm);
  document.getElementById('sim-sm-cost').textContent  = fmt(r.smC);
  document.getElementById('sim-sm-cost-theory').textContent = fmt(r.smCTheory);

  const smEl = document.getElementById('sim-sm-margin');
  smEl.textContent = fmt(r.smM, true);
  smEl.className   = 'font-black ' + (r.smM < 0 ? 'text-red-400' : 'text-emerald-400');

  const sigEl = document.getElementById('sim-supply-signal');
  sigEl.textContent = (r.supplySignal >= 0 ? '+' : '') + Math.round(r.supplySignal) + '/t';
  sigEl.className   = 'font-black ' + (r.supplySignal > 30 ? 'text-orange-400' : r.supplySignal > 0 ? 'text-yellow-400' : 'text-emerald-400');

  document.getElementById('sim-abs-mkt').textContent  = fmt(r.absM);
  document.getElementById('sim-abs-cost').textContent = fmt(r.absC);

  const gEl = document.getElementById('sim-abs-gap');
  gEl.textContent = fmt(r.absG, true);
  gEl.className   = 'font-black text-2xl ' + (r.absG < 0 ? 'text-red-500 alert-blink' : r.absG < 150 ? 'text-yellow-400' : 'text-emerald-400');

  document.getElementById('strategy-box').innerHTML = strategy(r);
}

function setScenario(wti, risk) {
  document.getElementById('slider-wti').value  = wti;
  document.getElementById('slider-risk').value = risk;
  onSlider();
}

function setSensCard(id, sensVal, r2Val) {
  const el   = document.getElementById('sens-' + id);
  const r2el = document.getElementById('r2-'   + id);
  if (!el) return;
  const v = parseFloat(sensVal);
  if (!isNaN(v)) {
    el.textContent = (v >= 0 ? '+' : '') + v.toFixed(2);
    el.className   = 'text-lg font-black ' + (v < 0 ? 'text-green-400' : 'text-yellow-300');
  }
  if (r2el) {
    const r2 = parseFloat(r2Val);
    if (!isNaN(r2)) {
      r2el.textContent = 'RÂ²=' + r2.toFixed(2);
      r2el.className   = 'text-xs mt-1 ' + (r2 >= 0.5 ? 'text-emerald-500' : r2 >= 0.3 ? 'text-yellow-600' : 'text-red-700');
    } else {
      r2el.textContent = 'default';
      r2el.className   = 'text-xs mt-1 text-slate-600';
    }
  }
}

function loadCSV() {
  Papa.parse('simulation_result.csv?t=' + Date.now(), {
    download:true, header:true, skipEmptyLines:true,
    complete: function(res) {
      if (!res.data || !res.data.length) return;
      const d = res.data[0];

      G.wti_rt        = parseFloat(d.WTI)              || G.wti_rt;
      G.wti_gs        = parseFloat(d.WTI_GSheet)       || G.wti_gs;
      G.bz            = parseFloat(d.BZ_Actual)        || G.bz;
      G.et            = parseFloat(d.ET_Actual)        || G.et;
      G.bd            = parseFloat(d.BD_Actual)        || G.bd;
      G.an            = parseFloat(d.AN_Actual)        || G.an;
      G.nap           = parseFloat(d.NAP)              || G.nap;
      G.sm_act        = parseFloat(d.SM_Actual)        || G.sm_act;
      G.abs_mkt_act   = parseFloat(d.ABS_Mkt_Actual)   || G.abs_mkt_act;
      G.pr_act        = parseFloat(d.PR_Actual)        || G.pr_act;
      G.bz_ara_act    = parseFloat(d.BZ_ARA_Actual)    || G.bz_ara_act;
      G.bz_usg_mt_act = parseFloat(d.BZ_USG_Actual)   || G.bz_usg_mt_act;
      G.sm_cost_act   = parseFloat(d.SM_Cost_Actual)   || G.sm_cost_act;
      G.sm_margin_act = parseFloat(d.SM_Margin_Actual) || G.sm_margin_act;
      G.sm_cost_theory_act   = parseFloat(d.SM_Cost_Theory_Actual)   || G.sm_cost_theory_act;
      G.sm_margin_theory_act = parseFloat(d.SM_Margin_Theory_Actual) || G.sm_margin_theory_act;
      G.sm_cost_gap_signal_act = parseFloat(d.SM_Cost_Gap_Signal_Actual) || G.sm_cost_gap_signal_act;
      G.abs_cost_act  = parseFloat(d.ABS_Cost_Actual)  || G.abs_cost_act;
      G.abs_gap_act   = parseFloat(d.ABS_Gap_Actual)   || G.abs_gap_act;

      // â˜… NAP ë¯¼ê°ë„ ê¸°ì¤€ ê°±ì‹ 
      if (d.NAP_Sens_Equiv_Basis) {
        NAP_SENS_EQUIV = parseFloat(d.NAP_Sens_Equiv_Basis) || NAP_SENS_EQUIV;
        document.getElementById('nap-sens-basis').textContent = NAP_SENS_EQUIV.toFixed(2);
        document.getElementById('logic-nap-sens').textContent = NAP_SENS_EQUIV.toFixed(2);
        document.getElementById('logic-equiv-100').textContent = (100/NAP_SENS_EQUIV).toFixed(1);
        const we100 = (100/NAP_SENS_EQUIV).toFixed(1);
        document.getElementById('risk-equiv-display').textContent =
          `í˜„ì¬ê¸°ì¤€: ë¦¬ìŠ¤í¬$100 â‰¡ WTI+$${we100}/bbl`;
      }

      // í—¤ë”
      document.getElementById('wti-price').textContent = `$${G.wti_rt.toFixed(2)}`;
      const delta = G.wti_rt - G.wti_gs;
      document.getElementById('wti-delta').innerHTML =
        `<span class="${delta>=0?'text-red-400':'text-green-400'}">êµ¬ê¸€ì‹œíŠ¸ ëŒ€ë¹„ ${delta>=0?'+':''}${delta.toFixed(2)}</span>`;

      const rt = calcFromG(G.wti_rt, 0);

      // ì¹´ë“œ ì—…ë°ì´íŠ¸
      document.getElementById('c-wti').textContent      = `$${G.wti_rt.toFixed(2)}`;
      document.getElementById('c-nap').textContent      = `$${Math.round(G.nap)}`;
      document.getElementById('c-bz').textContent       = fmt(rt.bz);
      document.getElementById('c-bz-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.bz)}`;
      document.getElementById('c-et').textContent       = fmt(rt.et);
      document.getElementById('c-et-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.et)}`;
      document.getElementById('c-bd').textContent       = fmt(rt.bd);
      document.getElementById('c-bd-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.bd)}`;
      document.getElementById('c-an').textContent       = fmt(rt.an);
      document.getElementById('c-an-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.an)}`;
      document.getElementById('c-pr').textContent       = fmt(rt.pr);
      document.getElementById('c-pr-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.pr_act)}`;
      document.getElementById('c-sm-mkt').textContent   = fmt(rt.sm);
      document.getElementById('c-sm-act').textContent   = `ì‹¤ì¸¡ $${Math.round(G.sm_act)}`;
      document.getElementById('c-abs-mkt').textContent      = fmt(rt.absM);
      document.getElementById('c-abs-mkt-act').textContent  = `ì‹¤ì¸¡ $${Math.round(G.abs_mkt_act)}`;
      document.getElementById('c-abs-cost').textContent     = fmt(rt.absC);
      document.getElementById('c-abs-cost-act').textContent = `ì‹¤ì¸¡ $${Math.round(G.abs_cost_act)}`;

      // SM Margin
      const smEl = document.getElementById('c-sm-margin');
      smEl.textContent = fmt(rt.smM, true);
      smEl.className = 'text-lg font-black ' + (rt.smM < 0 ? 'text-red-400' : 'text-emerald-400');

      // ABS Gap
      const gEl = document.getElementById('c-abs-gap');
      gEl.textContent = fmt(rt.absG, true);
      gEl.className = 'text-lg font-black ' + (rt.absG < 0 ? 'text-red-500 alert-blink' : rt.absG < 150 ? 'text-yellow-400' : 'text-emerald-400');

      // â˜… v6.2 ìˆ˜ê¸‰ì‹ í˜¸
      const sigEl = document.getElementById('c-supply-signal');
      sigEl.textContent = (rt.supplySignal >= 0 ? '+' : '') + Math.round(rt.supplySignal) + '/t';
      sigEl.className = 'text-xl font-black ' + (rt.supplySignal > 30 ? 'text-orange-400' : rt.supplySignal > 0 ? 'text-yellow-400' : 'text-emerald-400');
      document.getElementById('c-supply-signal-sub').textContent = rt.supplySignal > 0 ? 'â–² ìˆ˜ê¸‰ íƒ€ì´íŠ¸' : 'â–¼ ìˆ˜ê¸‰ ì—¬ìœ ';

      // SM Cost/Margin ì‹¤ì¸¡ vs ì´ë¡ 
      document.getElementById('c-sm-cost').textContent = fmt(rt.smC);
      document.getElementById('c-sm-cost-act').textContent = `ì‹¤ì¸¡ $${Math.round(G.sm_cost_act)}`;
      document.getElementById('c-sm-cost-theory').textContent = fmt(rt.smCTheory);
      document.getElementById('c-sm-cost-theory-act').textContent = `ì‹¤ì¸¡ $${Math.round(G.sm_cost_theory_act)}`;
      const sm2El = document.getElementById('c-sm-margin2');
      sm2El.textContent = fmt(rt.smM, true);
      sm2El.className = 'text-xl font-black ' + (rt.smM < 0 ? 'text-red-400' : 'text-emerald-400');
      const smThEl = document.getElementById('c-sm-margin-theory');
      smThEl.textContent = fmt(rt.smMTheory, true);
      smThEl.className = 'text-xl font-black ' + (rt.smMTheory < 0 ? 'text-red-400' : 'text-yellow-400');

      // BZ ARA
      document.getElementById('c-bz-ara').textContent     = fmt(rt.bzAra);
      document.getElementById('c-bz-ara-act').textContent = `ì‹¤ì¸¡ $${Math.round(G.bz_ara_act)}`;

      // BZ ìŠ¤í”„ë ˆë“œ ì„¹ì…˜
      document.getElementById('sp-bz-korea').textContent    = fmt(rt.bz);
      document.getElementById('sp-bz-ara').textContent      = fmt(rt.bzAra);
      document.getElementById('sp-bz-spread-ara').textContent = fmt(rt.bzSpreadAra, true);
      document.getElementById('sp-bz-korea2').textContent   = fmt(rt.bz);
      document.getElementById('sp-bz-usg').textContent      = fmt(rt.bzUsgMt);
      document.getElementById('sp-bz-spread-usg').textContent = fmt(rt.bzSpreadUsg, true);
      document.getElementById('bz-spread-insight').innerHTML = bzSpreadInsight(rt.bzSpreadAra, rt.bzSpreadUsg);

      // í—¤ë” ì§€í‘œ
      document.getElementById('hdr-abs-gap').textContent   = fmt(rt.absG, true);
      document.getElementById('hdr-sm-margin').textContent = fmt(rt.smM, true);
      document.getElementById('hdr-supply-signal').textContent = (rt.supplySignal >= 0 ? '+' : '') + Math.round(rt.supplySignal) + '/t';
      document.getElementById('hdr-bz-spread').textContent = fmt(rt.bzSpreadAra, true);
      document.getElementById('alert-badge').innerHTML     = alertBadge(rt.absG, rt.smM);

      // ë©”íƒ€
      document.getElementById('update-time').textContent = 'ê°±ì‹ : ' + (d.UpdateTime || '');
      document.getElementById('gs-date').textContent     = 'êµ¬ê¸€ì‹œíŠ¸: ' + (d.GSheet_Date || '');
      document.getElementById('wti-source').textContent  = d.WTI_Source || '';

      // ë¯¼ê°ë„ ì¹´ë“œ
      if (d.Sens_BZ)       { SENS.bz        = parseFloat(d.Sens_BZ);       setSensCard('bz',      d.Sens_BZ,      d.R2_BZ);        }
      if (d.Sens_ET)       { SENS.et        = parseFloat(d.Sens_ET);       setSensCard('et',      d.Sens_ET,      d.R2_ET);        }
      if (d.Sens_SM)       { SENS.sm        = parseFloat(d.Sens_SM);       setSensCard('sm',      d.Sens_SM,      d.R2_SM);        }
      if (d.Sens_BD)       { SENS.bd        = parseFloat(d.Sens_BD);       setSensCard('bd',      d.Sens_BD,      d.R2_BD);        }
      if (d.Sens_AN)       { SENS.an        = parseFloat(d.Sens_AN);       setSensCard('an',      d.Sens_AN,      d.R2_AN);        }
      if (d.Sens_NAP)      { SENS.nap       = parseFloat(d.Sens_NAP);      setSensCard('nap',     d.Sens_NAP,     d.R2_NAP);       }
      if (d.Sens_PR)       { SENS.pr        = parseFloat(d.Sens_PR);       setSensCard('pr',      d.Sens_PR,      d.R2_PR);        }
      if (d.Sens_BZ_ARA)   { SENS.bz_ara    = parseFloat(d.Sens_BZ_ARA);   setSensCard('bz_ara',  d.Sens_BZ_ARA,  d.R2_BZ_ARA);   }
      if (d.Sens_ABS_MKT)  { SENS.abs_mkt   = parseFloat(d.Sens_ABS_MKT);  setSensCard('abs_mkt', d.Sens_ABS_MKT, d.R2_ABS_MKT);  }
      if (d.Sens_ABS_GAP)  { SENS.abs_gap   = parseFloat(d.Sens_ABS_GAP);  setSensCard('abs_gap', d.Sens_ABS_GAP, d.R2_ABS_GAP);  }
      if (d.Sens_ABS_COST) { SENS.abs_cost  = parseFloat(d.Sens_ABS_COST); setSensCard('abs_cost',d.Sens_ABS_COST,d.R2_ABS_COST); }
      if (d.Sens_SM_COST)  { SENS.sm_cost   = parseFloat(d.Sens_SM_COST);  setSensCard('sm_cost', d.Sens_SM_COST, d.R2_SM_COST);  }
      if (d.Sens_SM_MARGIN){ SENS.sm_margin = parseFloat(d.Sens_SM_MARGIN);}

      if (d.Reg_N) {
        document.getElementById('reg-n-badge').textContent = d.Reg_N + 'ì£¼ ë°ì´í„°';
        document.getElementById('reg-meta').textContent    = 'ìµœì¢… ê°±ì‹ : ' + (d.UpdateTime || '');
      }

      document.getElementById('slider-wti').value = G.wti_rt.toFixed(2);
      onSlider();
      renderScenarios();

      if (rt.absG < 150) {
        document.getElementById('toast-msg').textContent =
          `ABS Gap ${fmt(rt.absG,true)} â€” ëª©í‘œ($150) ${Math.round(150-rt.absG)} ë¶€ì¡±`;
        document.getElementById('toast').style.display = 'block';
      }
    },
    error: function() {
      document.getElementById('update-time').textContent = 'CSV ë¡œë“œ ì‹¤íŒ¨';
    }
  });
}

function refreshImg() {
  document.getElementById('report-img').src = 'risk_simulation_report.png?t=' + Date.now();
}

renderScenarios();
onSlider();
loadCSV();
setInterval(loadCSV, 30000);
setInterval(refreshImg, 300000);
</script>
</body>
</html>
